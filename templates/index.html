<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python in HTML with Pyodide</title>
    <script src="https://cdn.jsdelivr.net/npm/pyodide@0.22.1/pyodide.js"></script>
</head>
<body>
    <h1>Real-Time Face Landmark Detection with Pyodide</h1>

    <video id="video" width="640" height="480" autoplay></video>
    <button id="start-button">Start Webcam</button>

    <script>
        async function loadPyodideAndRun() {
            // Load Pyodide and initialize it
            const pyodide = await loadPyodide();
            console.log("Pyodide loaded");

            // Load Python code into Pyodide environment
            await pyodide.runPythonAsync(`
import sys
import mediapipe as mp
import cv2
import numpy as np

mp_face_mesh = mp.solutions.face_mesh
mp_drawing = mp.solutions.drawing_utils
face_mesh = mp_face_mesh.FaceMesh(min_detection_confidence=0.5, min_tracking_confidence=0.5)

def process_frame(frame):
    frame_rgb = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    results = face_mesh.process(frame_rgb)
    
    if results.multi_face_landmarks:
        for face_landmarks in results.multi_face_landmarks:
            mp_drawing.draw_landmarks(frame, face_landmarks, mp_face_mesh.FACEMESH_TESSELATION)
    return frame
            `);
        }

        // Start the webcam when the button is clicked
        document.getElementById("start-button").onclick = async function() {
            const video = document.getElementById("video");
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            const mediaRecorder = new MediaRecorder(stream);
            const chunks = [];
            mediaRecorder.ondataavailable = function(event) {
                chunks.push(event.data);
            };
            mediaRecorder.onstop = function() {
                const blob = new Blob(chunks, { type: "video/webm" });
                const videoUrl = URL.createObjectURL(blob);
                video.src = videoUrl;
            };
            mediaRecorder.start();
        };
    </script>
</body>
</html>
