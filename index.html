<!DOCTYPE html>
<html lang="en">
<body>
  <video id="videoElement" autoplay></video>
  <script>
    let ws;
    let videoElement = document.getElementById('videoElement');

    function connectWebSocket() {
      ws = new WebSocket('ws://40.76.181.240:8089');

      ws.onopen = () => {
        console.log('WebSocket connected');
      };

      ws.onmessage = (event) => {
        // Process received frame
        console.log('Processed frame received');
      };
    }

    navigator.mediaDevices.getUserMedia({ video: true })
      .then((stream) => {
        videoElement.srcObject = stream;
        connectWebSocket();

        setInterval(() => {
          if (ws && ws.readyState === WebSocket.OPEN) {
            const canvas = document.createElement('canvas');
            canvas.width = 640;
            canvas.height = 480;
            canvas.getContext('2d').drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            const frame = canvas.toDataURL('image/jpeg');
            ws.send(frame);
          }
        }, 100);
      });
  </script>
</body>
</html>
